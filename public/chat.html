<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Chat</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>

  <a href="#main" class="skip-link">Skip to content</a>

  <header>
    <h1>AI Chat</h1>
    <nav>
      <a href="/index.html">Home</a>
    </nav>
  </header>
  <main id="main">
    <div id="messages" role="log" aria-live="polite"></div>
    <form id="chatForm">
      <label for="msg" class="visually-hidden">Message</label>
      <input id="msg" placeholder="Ask a question..." size="50" />
      <button id="voice" type="button" aria-label="Start voice input">ðŸŽ¤</button>
      <button type="submit">Send</button>
    </form>
  </main>
  <script>
    document.getElementById('chatForm').onsubmit = async e => {
      e.preventDefault();
      const input = document.getElementById('msg');
      const text = input.value.trim();
      if(!text) return;
      const messages = document.getElementById('messages');
      const userMsg = document.createElement('div');
      userMsg.textContent = 'You: ' + text;
      messages.appendChild(userMsg);
      const res = await fetch('/ai', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({text})});
      const data = await res.json();
      const botMsg = document.createElement('div');
      botMsg.textContent = 'AI: ' + (data.reply || JSON.stringify(data));
      messages.appendChild(botMsg);
      input.value = '';
      messages.scrollTop = messages.scrollHeight;
    };

    // Voice input using SpeechRecognition
    const voiceBtn = document.getElementById('voice');
    if (voiceBtn) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (SpeechRecognition) {
        const recognizer = new SpeechRecognition();
        recognizer.addEventListener('result', e => {
          const text = Array.from(e.results)
            .map(r => r[0].transcript)
            .join(' ');
          document.getElementById('msg').value = text;
        });
        voiceBtn.onclick = () => {
          recognizer.start();
        };
      } else {
        voiceBtn.style.display = 'none';
      }
    }

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }
  </script>
</body>
</html>
